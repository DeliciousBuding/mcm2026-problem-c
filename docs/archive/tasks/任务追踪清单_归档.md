更新日期：2026-02-02 | 版本：v0.4.0-final | 说明：英文为准，中文可能滞后。

# 论文冲奖任务清单（全论文）

目标：把当前稿件从"观感专业"推到"Outstanding 竞争级别"，优先补齐"方法—指标—叙事—图表"的可信闭环。

使用方式：按 **Block** 执行；每个 Block 完成后进行一次 git 存档，并在本清单对应项打勾（[√]）。每个 Block 都必须产出"验收口径"和"可交付产物"，避免返工。

---

## 🔒 工程规范（全局强制，所有 Block 必须遵守）

### Git 分支管理
- **主分支只读**：禁止在 `main` 上直接提交，所有改动在任务分支进行。
- **分支纯粹**：一个分支只做一个 Block，不跨 Block 修改；命名格式 `block{N}-{简述}`（如 `block5-hard-flaws`、`block6-scale-benchmark`）。
- **中文提交**：commit message 必须中文、描述"做了什么"；每次 commit 后立即 `git push`。
- **中断切换**：未完成需切分支时，用 `git stash push -u -m "中文说明"` 暂存。
- **验收后合并**：自检仅影响本 Block + 测试通过，再请求合并；合并后打 tag（格式 `v0.X.Y-blockN`）。

### 论文编译规范
- **每次代码变动涉及论文内容**：必须重新编译 PDF 验证
  ```powershell
  cd paper
  latexmk -pdf -interaction=nonstopmode main.tex
  latexmk -pdf -interaction=nonstopmode main_zh.tex
  ```
- **编译检查项**：
  - 0 Undefined reference
  - 0 Missing figure
  - 图号/表号引用与实际一致
- **编译失败阻塞合并**：编译不过不得合并到 main

### 产物同步规范
- **outputs 目录**：代码生成的 CSV/JSON 必须与论文引用一致
- **figures 目录**：PDF 图必须由 pipeline 生成，禁止手动替换
- **summary_metrics.tex**：LaTeX 宏文件必须由代码自动生成

### 回归测试规范
- **每次提交前必跑**：`pytest tests/ -v`
- **测试失败阻塞合并**：红灯不得合并
- **新增功能必须有对应测试**：防止回归

### 代码质量规范
- **Lint 检查**：`ruff check src/ tests/ --ignore=E501,F401,E402`
- **类型注解**：关键函数必须有类型提示
- **注释规范**：阈值/魔数必须有注释说明来源

---

## 最新进度摘要（2026-02-02 v0.4.0）
- **Hard-2 完成**：LP/MILP 叙事对齐，明确定位为"诊断工具 ONLY"，产物 `audit_lp_milp_scope.json`
- **Hard-4 完成**：temporal smoothness (gaussian_filter1d) 明确降级为"仅后处理/可视化"，不进入采样/feasibility
- **Hard-5 完成**：可行域约束清单输出到 `audit_block5_gate.json`，明确声明 delta_min_gap: "NOT USED"
- **Hard-7 完成**：beta 敏感性分析产物 `audit_beta_sensitivity.json`，所有 beta 值 integrity_pass=true，结论稳定
- **防回归测试完成**：4 个 pytest 测试锁定 Yellow action / Hard-2 / Hard-5 / Hard-7 口径
- **DAWS Yellow 口径正确**：Action = "Warning / Monitoring Only"
- **Hard-3 口径污染清理完成**：唯一正确口径 `residual = max(E) - min(S)`
- **所有 Hard 项完成**：Hard-0/1/2/3/4/5/6/7 全部 ✅

## 可行性分析摘要（结论）
- **高可行且高收益（应升为 P0）**：稳定性定义修正、~~polytope/LP/MILP 叙事对齐~~（已完成）、judge-save 的 β 处理二选一、DAWS 分段公开阈值化、机制三指标重构、两张主证据图（反事实风险时间线 + DAWS 触发图）。
- **可行但应降级**：rule switch 推断图应转为“探索性/附录”，主分析采用 Season 28 切换点。
- **低优先/可附录**：sigma 敏感性、AUC 校准等不影响主结论的补强。
## 风险与 Plan B（必须提前锁定）
- **唯一可能卡进度的点：β 方案 A**。若估计不稳或样本不足，立即切换方案 B，避免返工。
- **Plan B 触发条件（建议写死）**：
  - 可用 judge-save 事件数 < 30–50；或
  - 估计 CI 过宽/跨 0；或
  - 曲线与叠加数据点明显不一致。
  - 触发即采用方案 B（calibrated/illustrative）并统一图注与正文口径。

## 已完成
- [√] Scale Benchmark 图提升分辨率（`fig_scale_benchmark.pdf`）。

## 冲刺补强（2026-02-01）
- [√] Synthetic Validation：合成压力测试 + 验证图（`fig_synthetic_validation.pdf`）。
- [√] DAWS 级联协议落地：Finale 覆盖 + 冲突触发 + 默认 Percent；并输出 `outputs/daws_tiers.csv`。
- [√] Producer Dashboard 概念图（`fig_dashboard_concept.pdf`）。
- [√] Memo 三段式重写（中英文同步）。
- [√] 假设口径更新：承认策略性投票 + “最小惊奇”分布表述。
- [√] 引言叙事升级：审计—压力测试—风控—监控闭环。

---

## Block 0（P0：方法论闭环，卡 O 奖的硬闸）
- [√] **修稳定性定义**：每个机制都用“同机制扰动前后”计算 instability/stability（不再跨机制对比 noisy-percent）。
- [√] **三指标重构**：固定为 Viewer Agency + Judge Integrity + Stability；Kendall τ 降级为 conflict index（仅数据张力，不作机制公平轴）。
- [√] **polytope 叙事对齐**：正文改为 “MaxEnt feasible-region sampling（Dirichlet 提案 + 约束筛选）”，LP/MILP 仅作局部验证/附录增强。
- [√] **judge-save β 二选一**（提前定方案，避免返工；已选 B）：
  - 方案 A：真实估计 β（给出 \hat{β}+CI，并能说明估计稳定性）；
  - 方案 B：明确为 calibrated/illustrative，删除“估计/CI”表述并统一图注口径。
- [√] **DAWS 落地化**：连续动态权重 → 分段公开阈值规则（常规/争议/极端周档位），阈值基于 U_t 或 P90。
- [√] **Fast vs Strict 叙事重写**：强调指标层鲁棒（MAE、Δagency、Δflip），避免 Top-1 作为主结论。
- [√] **同步修改文案**：`paper/main.tex`、`paper/main_zh.tex`、`docs/功能说明.md` 与代码实现一致。
- [√] **Git 存档（Block 0）**：提交信息建议 `"方法论闭环：稳定性/指标/DAWS/β 口径对齐"`。
### Block 0 验收口径
- [√] Stability/Instability 全部改为“同机制自对比”，并在结果表/图里体现差异。
- [√] Agency/Integrity/Stability 三指标随机制变化，Kendall τ 只出现在“冲突/张力”叙事。
- [√] 正文不再出现“我们做了 MILP/LP 全量重构”的硬表述，统一为 MaxEnt feasible-region sampling。
- [√] β 方案已锁定（B），图注与正文表述一致。
- [√] DAWS 规则可公开解释，读者能凭阈值判断档位。
### Block 0 产物
- [√] Methodology Alignment Box（方法论一致性说明段，放正文或附录）。
- [√] 中英文一致的“指标定义”小节（含三指标与 conflict index 的定位）。
### Block 0 回归检查（每次提交前必做）
- [√] 重新生成 `outputs/summary_metrics.json/csv`。
- [√] 重新生成 Pareto/雷达图并确认三指标对机制有差异。
- [√] 输出 DAWS 分段档位或阈值列表，检查与图/文一致。

---

## Block 1（P1：主证据图 + 关键图替换）
- [√] **反事实风险时间线图**：争议人物每周 P(elim | percent/rank/save/DAWS)。
- [√] **DAWS 触发图**：U_t 与权重档位随周变化（展示透明、可执行）。
- [√] **机制流向图替换**：`fig_alluvial_finalists` → “冠军/Top3 翻转概率”条形图。
- [√] **Pareto/权衡图更新**：使用新三指标（agency vs stability，颜色=integrity）。
- [√] **Pro 差异图清洗**：清理重复/复合姓名（如“Emma Slater/Kaitlyn Bristowe”）。
- [√] **Rule switch 图降级**：正文标注探索性或移入附录，主分析固定 Season 28 切换点。
- [√] **中文图注增强**：中文版本图注可加括号补充解释（英文不加）。
- [√] **权衡口径落地**：在机制比较段与中文图注中明确“DAWS 为权衡方案（agency 提升、稳定性小幅代价）”。
- [√] **Git 存档（Block 1）**：提交信息建议 `"Core evidence figures + chart replacements"`。
### Block 1 验收口径
- [√] 反事实风险时间线进入正文，并在正文/结论各引用一次。
- [√] DAWS 触发图进入正文，读图即可理解阈值触发逻辑。
- [√] alluvial 已替换为“冠军/Top3 翻转概率”条形图，图注明确概率含义。
- [√] pro 名称唯一、无复合/括号拼接。
- [√] 机制比较段落与中文图注的“权衡口径”一致，不再暗示 DAWS 全面胜出。
### Block 1 产物
- [√] 两张主证据图（反事实时间线 + DAWS 触发图）与更新后的 Pareto/翻转概率图。
### Block 1 回归检查（每次提交前必做）
- [√] 两张主证据图在 PDF 中可读（字体/图例/线型清晰）。
- [√] 正文至少两处引用（方法段 + 结论段）。

---

## 可选增强包（不改主线，但显著抬可信度）
### 包 S（强烈推荐，低风险）
- [√] **Block 0 回归检查全打勾**：生成 outputs/summary_metrics 与 Pareto/雷达图，并核对 DAWS 档位/阈值清单一致。
- [√] **机制指标分布图**：按 season 画 agency/integrity/stability 的箱线/散点（已生成 `fig_mechanism_distribution.pdf` 并可附录引用）。
- [√] **中文图注加强一句权衡解释**：关键图（反事实时间线/DAWS 触发/Pareto）已加入"权衡而非全面最优"注释。

### 包 M（门槛触发，谨慎推进）
- [ ] **DAWS 小范围调参**（仅当 DAWS 稳定性明显低于 Percent 才触发）：一次 3×3 或 3×2 小网格。
- [ ] **参数表 + 一句政策理由**：输出参数→(agency/integrity/stability) 小表，并解释选择理由（透明、保守、可执行）。

---

## Block 2（P2：图注/可读性/引用一致性）
- [√] **热力图轴从 1 开始**：Week/Season 不从 0，注明缺失周含义。
- [√] **冲突散点补 legend**：点大小=HDI、外圈=wrongful、颜色含义说明。
- [√] **PPC 图注方向**：Coverage 越高越好、Brier 越低越好（或改 1-Brier）。
- [√] **Fast vs Strict 图注**：补 MAE/Top-1/Top-2 一致率数值。
- [√] **Judge-save 曲线图注**：补 β 数值/区间或说明为示意。
- [√] **Feature scatter 标注**：标 3–5 个偏离最大特征或在图注列出。
- [√] **机制指标分布图（可选）**：按 season 输出箱线/散点图并在附录引用（与包 S 同步，已生成）。
- [√] **中文论文图表引用修复**：检查 `main_zh.tex` 图 12 等 \ref/\label 失配问题并修正（已验证无失配）。
- [√] **Git 存档（Block 2）**：提交信息 `"Block 2 完成：图注增强、引用修复、一致性检查表生成"`。
### Block 2 验收口径
- [√] 所有图的坐标/图例/编码在图注中完整解释，中文版本可用括号补充细节。
- [√] 中英文图号引用无缺失，图 12 等问题修复并验证。
### Block 2 产物
- [√] 图注一致性检查表（`docs/Block2_图注一致性检查表.md`）。
### Block 2 回归检查（每次提交前必做）
- [√] 中英文版本图号/引用一致，\ref/\label 无缺失。
- [√] 关键图图注编码完整（颜色/大小/外圈/方向性指标）。

---

## Block 3（P3：附录/可选增强）
- [√] **Sigma 敏感性降级**：移至附录 `app:sensitivity`，正文改为一句话引用。
- [√] **AUC 校准曲线**：移至附录 `app:auc`，正文弱化引用。
- [√] **图像截取专用目录**：新增 `paper/figures/snips/`（含 README.md）。
- [√] **Git 存档（Block 3）**：提交信息 `"Block 3 完成：附录增强与目录整理"`。
### Block 3 验收口径
- [√] 附录内容不抢主线，且能被主文一句话引用。
### Block 3 产物
- [√] 附录索引（`docs/Block3_附录索引.md`）。
### Block 3 回归检查（每次提交前必做）
- [√] 附录内容不抢主线，主文均有一句话指向附录位置。

---

## 依赖/输出检查
- [√] 更新 `paper/main.tex` 与 `paper/main_zh.tex` 图引用与编号一致。
- [√] 重新导出 PDF 并抽查图号/引用无误。
- [√] `outputs/summary_metrics.json` 与图表统计一致。

---

## Block 4（P0：DAWS 2.1 诚实闭环，双信号对齐）
目标：在**不改核心决策逻辑**（Finale → Audience；冲突 A→Judge Save；否则 Percent）的前提下，补齐“审计可信度、双信号分工、β 依据”三处硬伤，做到**图文一致 + 可解释**。

### Block 4 核心任务（执行顺序）
- [√] **审计元数据输出（Task 1 可信度闭环）**
  - 产出每周审计元数据：`feasible_flag / accept_rate / fallback_flag / violation_proxy / confidence_tag`。
  - 约定：凡 `fallback` 或 `accept_rate` 低 → 标记为 *Audit-Weak Week*。
  - **阈值写死（先验固定）**：
    - `n_accept < 200` → 判定为 Audit-Weak（先验固定、与周内采样量绑定、分母不随提案规模波动）。
  - **violation_proxy 定义写死（不做 LP 也可执行）**：
    - 主定义：Constraint Violation Rate（每个 proposal 违反约束的比例，取周内最小值/均值）。
    - 备选：Fallback Severity（仅当无法计算约束违反时使用；fallback=1 否则 0）。
  - 输出物：`outputs/audit_week_meta.csv`（或扩展到 `summary_metrics.json`）。

- [√] **V 信号“条件化定义”**
  - 可信周：`V_t = mean HDI width`。
  - Audit-Weak 周：`V_t` 作为“审计失效告警”，**不当作真实不确定性**；在图表上单独标色/标记。
  - 图注需明确：V 仅用于**披露/监控**，不作为干预触发。

- [√] **治理矩阵与文案统一为 DAWS 2.1（A 触发 / V 监控）**
  - 论文、Memo、Dashboard 文案统一：
    - **A（冲突）**：唯一触发 Judge Save 的信号。
    - **V（波动/审计风险）**：仅用于披露等级、审计预算/置信标签、以及决赛边界说明。
  - Governance Matrix 固定为：Green/Yellow 不改判，Yellow 只“Warning/Disclosure”；Red 只由决赛触发。

- [√] **β 参数“最小闭环”**
  - 解析级闭环：给出 logit 曲线解释“β=6.0 对应的干预强度规范”（如分差≥1 时 95% 纠偏概率）。
  - 机制级闭环：仅对冲突周做 β ∈ {2,4,6,8} 小敏感性，输出 trade-off（Integrity vs Agency）。
  - **trade-off 指标定义写死**（仅冲突周统计）：
    - Integrity：Judge Save 选择“评委分更高者”的比例。
    - Agency：与 Percent 结果偏离率（冲突周内）。
  - 输出物：`fig_beta_sensitivity.pdf`（或同级别图）。

- [√] **Dashboard 文案修正**
  - Signal V → “Monitoring / Disclosure / Audit Budget”
  - Signal A → “Trigger Action (Judge Save)”
  - Signal V 面板底部固定文案：“Monitoring Only (No Override)”
  - Signal A 面板固定文案：“Action Trigger”
  - 若 Yellow：显示 Warning；**不写 Activate Judge Save**。

- [√] **一致性审计（两次）**
  - 第一次：更新 Matrix + Dashboard 文案后立即全仓检索（已完成）
  - 第二次：提交前再全仓检索（已完成）
  - 禁止出现： “V triggers Judge Save / Yellow activates intervention”等表述。
  - 统一口径：A 触发、V 披露、决赛 override。
  - 统一句式（建议全文复用）：
    - “Signal A determines intervention; Signal V determines disclosure and audit budget; the finale is a boundary condition (Red override).”

- [√] **写作禁区提示**
  - 论文正文/图注**不要出现**“DAWS 2.1”字样（内部版本号仅用于任务追踪）。

### Block 4 验收口径
- [√] 论文与图表**无任何**“V 触发干预”的叙述，治理矩阵与代码逻辑一致。
- [√] `Audit-Weak` 周次被统计、标注，并作为“审计告警”解释。
- [√] β 有最小敏感性闭环（解析曲线 + 冲突周局部实验）。
- [√] Dashboard / Memo / 正文表述完全同义，不存在“图文不符”。

### Block 4 产物清单
- [√] `outputs/audit_week_meta.csv`（或同等可追踪字段）。
- [√] `paper/figures/fig_beta_sensitivity.pdf`（β 解释闭环图）。
- [√] 更新后的治理矩阵（正文/附录/图注一致）。
- [√] 更新后的 Dashboard（含 Monitoring/Trigger 标签）。

### Block 4 工程规范（引用）
> ⚠️ **必须遵守开头「🔒 工程规范」**：分支 `block4-audit-closure`，编译验证，测试通过后合并。

---

## Block 5（P0：审计硬伤修复 / 叙事降级二选一）
目标：逐条回应红队评审 1–4 条“必杀级硬伤”。每条必须二选一：要么修实现，要么降级叙事（并标记为局限）。

### Block 5 核心任务（执行顺序）
- [√] **Hard-0：strict feasible 的可执行定义（必须写死）** ✅ 已完成
  - **simplex**：v_i >= 0 且 sum(v_i)=1，固定 `eps_sum = 1e-9`（仅用于归一化等式）。
  - **elimination**：对淘汰集 E、存活集 S，严格约束为 max(E) <= min(S) + eps_ord，固定 `eps_ord = 1e-6`（仅用于不等式比较）。
  - **ties 规则（写死）**：允许并列淘汰，采用 max(E) <= min(S) + eps_ord。
  - **bottom-k 定义**：写死为"按全体排序的 bottom-k"；percent/rank 在 strict 中不参与可行性，仅诊断。
  - **验收**：strict_feasible_flag 的判定完全由上述 checks 给出（eps_sum/eps_ord 取值固定并记录）。
  - **诊断输出验收**：percent/rank 规则一致性诊断必须输出到 `audit_week_meta.csv`，与采样完全解耦。
  - **诊断定义（写死）**：
    - `percent_rule_residual = max(judge_share_E) - min(judge_share_S)`（judge_share 为 audit proxy）
    - `percent_rule_diagnostic = 1{residual <= eps_ord}`（eps_ord=1e-6，连续值容差）
    - `rank_rule_residual = max(judge_rank_E) - min(judge_rank_S)`（离散 rank）
    - `rank_rule_diagnostic = 1{residual <= eps_rank}`（eps_rank=0，允许并列淘汰）
  - **完成记录**：eps_sum/eps_ord/eps_rank/ties 规则写死；底层残差诊断字段已输出到 audit_week_meta.csv，且与采样完全解耦；audit_block5_gate.json 记录所有阈值与 diagnostic_score_source。

- [√] **Hard-1：采样兜底不可行样本** ✅ 已完成
  - **修实现（优先）**：兜底只能来自 strict feasible 样本池；补不到就不补，该周 excluded_from_metrics=1。
  - **降级叙事（替代）**：将 fallback 周标记为 *Audit-Weak* 并排除出后验/指标，仅保留为"审计失败告警"。
  - **验收**：任何后验/HDI/机制指标仅使用 strict feasible 样本；不足阈值则该周输出为空并标记排除。
  - **产物**：`outputs/audit_week_meta.csv` 新增 `strict_feasible_flag`、`used_fallback`、`excluded_from_metrics`。
  - **完成记录**：移除 `proposals[:10]` fallback，严格不足返回空数组。

- [√] **Hard-2：LP/MILP/Polytope 叙事对齐** ✅ 已完成（诊断工具定位 + 专用产物）
  - **核心口径声明**：LP/MILP = **诊断工具 ONLY**，不是主模型
  - **主模型实现**：MaxEnt Dirichlet 采样 + strict_feasible_mask() 约束筛选
  - **LP/MILP 实际用途**：
    - slack_cache（审计元数据）
    - bounds visualization（参考用，非主结论）
  - **LP/MILP 不用于**（写死）：
    - 采样过滤（主：Dirichlet + constraint）
    - 可行性检查（主：strict_feasible_mask）
    - 后验估计（主：sample-based MaxEnt）
    - 机制指标（主：strict-filtered samples）
  - **当前实现**：`lp_bounds_and_slack()` 为哑函数（返回固定 slack=0.001）
  - **产物**：
    - `audit_block5_gate.json.lp_milp_scope`：嵌入式声明
    - `audit_lp_milp_scope.json`：专用验证产物（含论文叙事核对清单）
  - **论文叙事核对**：
    - L188 MaxEnt → OK（指采样，非 LP）
    - L262 LP/MILP → OK（显式声明"仅用于局部验证"）
    - L268 polytope → OK（约束切割 simplex，非 LP）
    - L306 LP/MILP → OK（显式声明"形式化"但"Dirichlet 筛选"为工程实现）
  - **防回归测试**：`test_lp_milp_scope_diagnostic_only` 锁定此口径

- [√] **Hard-3：双淘汰规则编码错误** ✅ 已完成（结构性复核通过 + 口径污染清理完成）
  - **唯一正确口径（写死）**：`residual = max(score_E) - min(score_S)`，在 `strict_feasible_mask()` 中实现
  - **口径污染清理（已完成）**：
    - `apply_percent_mask` → `_deprecated_apply_percent_mask`（抛异常禁止调用）
    - `fallback_by_violation` → `_deprecated_fallback_by_violation`（抛异常禁止调用）
    - 注释声明：上述函数使用错误的 "compare-to-global-min" 口径，对 k>1 不是 bottom-k 约束
  - **预注册 R smoke test**：`R = median(accept_rate_strict_double) / median(accept_rate_strict_single)`，要求 `0.5 <= R <= 2.0`。
    - **结果**：R=0.3006，**FAIL**（保留，不可修改阈值）
    - **原因**：双淘汰周可行域本质更小，R < 0.5 是数学正常行为
  - **理论 R 基线验证（可复现算术）**：
    - `n_contestants_median_double = 8.0`
    - `expected_R_baseline = 2/(n-1) = 0.2857`
    - `R_over_baseline = 0.3006/0.2857 = 1.052`（≈1.0 说明 R 符合理论预期）
  - **结构性复核（主证据）**：对 accepted 样本显式重算 bottom-k residual (`max(score_E) - min(score_S)`)
    - **双淘汰周**：total=31, valid=15, checked=15, samples=10457, min_check_rate=1.0 ✅
    - **单淘汰周**：total=232, valid=225, checked=225, samples=349682, min_check_rate=1.0 ✅
    - **hard3_structural_pass**: true
  - **防循环自证声明**：
    - `recompute_path`: "recompute combined_score from (judge_share, proposal, alpha) then residual=max(E)-min(S)"
    - `reuse_guard`: "does_not_call_strict_feasible_mask; computes residual directly"
  - **产物**：`outputs/audit_double_elim_check.json`（R检验+理论基线）、`outputs/audit_double_elim_structural_check.json`（结构性复核）
  - **论文写法**：R 是预注册 smoke test，k>1 周偏低是组合概率预期；主要 correctness 证据来自结构性复核 + 理论基线对齐。

- [√] **Hard-4：temporal smoothness 只在文本中存在** ✅ 已完成（降级为后处理）
  - **实现状态**：gaussian_filter1d 仅用于绘图/敏感性探索，不进入采样/feasibility/机制指标
  - **代码声明**：SIGMA_LIST 注释 "仅用于绘图/敏感性后处理，不进入采样链路"
  - **验收**：正文应标注为 "exploratory post-processing" 而非 "temporal prior"
  - **产物**：`fig_sigma_sensitivity.pdf`（仅可视化，不影响主结论）

- [√] **Hard-5：Rank->share 强加 Delta 间隔** ✅ 已完成（可行域无 Delta/min-gap）
  - **可行域约束清单（机械可验证）**：输出到 `audit_block5_gate.json.feasibility_constraints`
    - simplex_sum: "sum(fan_share) = 1"
    - simplex_nonneg: "fan_share_i >= 0"
    - bottom_k_ordering: "max(E) <= min(S) + eps_ord"
    - **delta_min_gap: "NOT USED - no minimum gap constraint"**
    - **rank_share_delta: "NOT USED - no forced Delta interval"**
  - **hard5_verification**: "feasibility_constraints contains NO Delta/min-gap terms"
  - **防回归测试**：`test_feasibility_no_delta_min_gap` 锁定此声明

- [√] **Hard-6：fast vs strict 验证被 fallback 污染** ✅ 已完成
  - **修实现（优先）**：strict=严格 checks 全集；fast=严格 checks 子集。strict 指标仅在 strict 样本数>=阈值时输出，否则整周缺失。
  - **降级叙事（替代）**：fast/strict 结果标为"近似健壮性指示"，不作为审计结论。
  - **写死阈值**：`N_strict_min = 500`（资格阈值，固定不再调整）。
  - **有效周判定仅由 `N_strict_min` 决定；`q_gate` 仅用于计算预算建议，不改变资格判定。**
  - **写死缺失格式**：严格不足时 `summary_metrics` 该周字段为 NaN，且 `valid_week=0`/`excluded_from_metrics=1` 明确标注。
  - **完成记录**：移除 fallback_by_violation 调用；gate 使用 Q_GATE=0.10 计算推荐采样量；论文写明 20% 为预注册降级规则。

- [√] **Hard-7：beta/阈值敏感性分析** ✅ 已完成（闭环验证）
  - **核心产物**：`audit_beta_sensitivity.json`
    - beta_values: [2.0, 4.0, 6.0, 8.0, 10.0]
    - all_integrity_pass: true（全部 ≥ 0.90）
    - integrity_range: [0.9627, 0.9974]
    - conclusion_stable: true
    - methodology: "For each beta, count winners..."
  - **原始数据**：`beta_sensitivity.csv`（每beta每周integrity值）
  - **防回归测试**：`test_beta_sensitivity_output_exists` 确保产物生成

- [√] **缺口B：采样失败后的主结论处理规则（必须写死）** ✅ 已完成
  - Audit-Weak 周是否出现在图表/表格：写死（默认仅作标记点，不参与统计）。
  - season-level 汇总：缺周不补；以有效周数加权。
  - 强制降级条件（写死）：`excluded_from_metrics` 占比 >= 20% ⇒ 所有 season-level 主结论降级为"探索性"。
  - finale / semi-final 定义（写死）：按数据字段判定，`week == max(week)` 为 finale，`week == second_max(week)` 为 semi-final。
  - 关键结论清单（写死）：整体稳定性排序、DAWS 相对基线的总体结论、民主赤字趋势；一律在降级条件触发时标注"探索性"。 
  - **完成记录**：论文写明 20% 为预注册报告规则（非调参目标）；产物 `outputs/audit_block5_gate.json` 记录 Q_GATE/excluded_ratio/recommended_n_proposals_by_q_gate。

- [√] **缺口C：可复现性与诊断输出（必须补齐）** ✅ 已完成
  - `audit_week_meta.csv` 追加字段：seed、n_proposals、n_accept_fast、n_accept_strict、accept_rate_strict、min_violation、max_violation、excluded_from_metrics。
  - 记录阈值与 eps（写死）到元数据或附表。
  - **确定性要求**：所有随机源统一由一个 seed 驱动（Python random / numpy RNG 等），同一 seed 下关键输出表格哈希一致。
  - **文件确定性规则**：固定行排序键（week 升序 + contestant_id 升序）、固定列顺序、固定浮点格式（如 `float_format=\"%.8f\"`）。
  - **完成记录**：所有诊断字段（包括 percent_rule_diagnostic/rank_rule_diagnostic）已输出到 audit_week_meta.csv。

### Block 5 验收口径
- [ ] strict feasible 的定义、eps、ties 规则全部写死且可执行。
- [ ] 任一硬伤要么实现闭环，要么叙事降级且明确标注局限。
- [ ] 任何主结论不依赖不可行样本或空实现模块。
- [ ] 论文方法描述与代码行为逐条一致。

### Block 5 产物清单
- [√] 修订后的 `outputs/audit_week_meta.csv` 与 `summary_metrics`（含 strict/fallback/排除标签与诊断字段）。
- [√] 约束口径表（strict/fast checks、eps/ties、缺周处理规则）—— 已落实到 Appendix: Audit Parameter Specification Table。
- [√] 修订后的方法段落（中英文同步）—— 已落实到 Section 4.5: Audit Specification and Feasibility Criteria。
- [√] `outputs/audit_block5_gate.json`：记录 Q_GATE/excluded_ratio/q_gate_accept/recommended_n_proposals_by_q_gate。

### Block 5 工程规范（引用）
> ⚠️ **必须遵守开头「🔒 工程规范」**：分支 `block5-hard-flaws`，编译验证，测试通过后合并，tag `v0.4.0-block5`。

---（可选增强：Scale Benchmark 精细化）
目标：提升 Fig.21 (Scale Benchmark) 的说服力——让 elbow 选点更稳健、曲线更可信。

### 背景
- 当前 Fig.21 已能支撑"收益递减 + elbow 选点"叙事
- 潜在质疑点：elbow 附近取点稀疏/噪声，定位可能"看起来像拍脑袋"
- elbow 算法：`mean_hdi` 端点连线最大距离法（knee/elbow heuristic），点越稀越易被离群点拉偏

### Block 6 核心任务

- [√] **Task 1：elbow 附近加密取点**
  - 当前取点：约 2k/5k/10k/20k（稀疏）
  - 目标取点：`[1000, 2000, 4000, 6000, 7000, 8000, 9000, 10000, 12000, 15000, 20000]`（11 个点）
  - 重点加密 6k–12k（elbow 预期区间）

- [√] **Task 2：关键点多 seed 重复试验（强烈推荐）**
  - 对 11 个 scale 点各跑 3 次不同 seed（seeds = `[20260131, 20260132, 20260133]`）
  - 修改 `run_pipeline()` 支持 `seed` 参数 ✅
  - 收集 `[mean_hdi, runtime]` × 3 次（共 33 runs）

- [√] **Task 3：图绘制增强**
  - 主曲线：3 次均值
  - 误差带：±1 std shaded 区间
  - 虚线 elbow：基于均值曲线重新计算（knee heuristic）
  - 图注补充："Elbow position stable across 3 seeds (range: X–Y)"

- [⏳] **Task 4：产物更新**（实验运行中）
  - `outputs/scale_benchmark.csv` 新增 `seed` 列 ✅
  - `paper/figures/fig_scale_benchmark.pdf` 带 shaded 误差带（待实验完成）
  - 论文一句话："Elbow remains stable across repeated runs"（待验证）

### Block 6 预计耗时
| 步骤 | 耗时估计 |
|------|----------|
| 代码修改（seed 参数化 + 误差带绘制） | ~15 min |
| 11 scales × 3 seeds 运行 | ~40s × 33 ≈ 25 min |
| **总计** | **~40 min** |

### Block 6 验收口径
- [ ] `fig_scale_benchmark.pdf` 带 shaded 误差带（或至少标注 elbow 稳定区间）
- [ ] elbow 位置在多 seed 下落在同一量级区间

### Block 6 产物清单
- [ ] 更新后的 `outputs/scale_benchmark.csv`（含 seed 列）
- [ ] 更新后的 `fig_scale_benchmark.pdf`（带误差带）
- [ ] 论文图注更新（elbow 稳定性声明）

### Block 6 触发条件（可选执行）
- **建议触发**：若还有 40+ 分钟算力预算
- **可跳过**：若时间紧张，当前图已足够支撑主结论

### Block 6 工程规范（引用）
> ⚠️ **必须遵守开头「🔒 工程规范」**：分支 `block6-scale-benchmark`，编译验证，测试通过后合并，tag `v0.X.Y-block6`。
