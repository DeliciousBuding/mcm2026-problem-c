# 03_算法框架（最终版）

本文将 DWTS 建模为“审计（audit）+ 机制设计（design）”的流水线，核心目标是：在不知道真实粉丝票的前提下，恢复可行投票区间并量化不确定性，继而比较规则并提出可执行的新机制。

## 1. 输入与输出
**输入**
- 原始数据：`data/2026_MCM_Problem_C_Data.csv`
- 规则信息：percent / rank / judge-save / irregular weeks（免疫、双淘汰）

**主要输出**
- 周度后验（粉丝份额 HDI、可行性与不确定性指标）
- 机制对比指标（agency / integrity / stability / conflict）
- 驱动分析（裁判 vs 粉丝差异、pro dancer effects）
- 机制设计方案（DAWS + 参数与触发规则）
- 论文图表与 summary_metrics

## 2. 流水线总览（从数据到机制）
1) **数据整理**：将宽表转换为 season–week 面板，提取 `J_{i,t}`、`E_t`、免疫/双淘汰标记。
2) **规则形式化**：建立 percent / rank / save 的淘汰约束。
3) **可行域审计（Model A）**：在 simplex 上构造可行多面体 `\mathcal P_t`，用拒绝采样近似后验并输出 HDI。
4) **不确定性评估**：利用 accept-rate 与 HDI width 识别 audit-weak weeks。
5) **机制对比（Model B）**：对 percent / rank / save / DAWS 做统一指标对比。
6) **驱动分析（Model C）**：混合效应模型比较 judges vs fans 的 covariate/pro dancer 影响差异。
7) **机制设计（Model D）**：DAWS（冲突触发 + judge-save）与策略解释。
8) **验证与敏感性**：PPC + 合成验证 + 参数扫掠。

## 3. 核心模型要点
### 3.1 Model A：可行域审计与后验
- Simplex：
  \[
  \mathcal S_n = \{\mathbf v \in \mathbb R^n: \sum_i v_i=1,\ v_i\ge\epsilon\}
  \]
- Percent 规则：
  \[
  c_{i,t}(\alpha)=\alpha j_{i,t}+(1-\alpha)v_{i,t},\quad c_{E_t,t}(\alpha)\le c_{i,t}(\alpha)
  \]
- Rank 规则：通过排序约束（或 MILP）连接 rank 与 share。
- 输出：周度可行样本、HDI、audit-weak 标记。

### 3.2 Model B：机制对比
- 统一指标：agency / integrity / stability / conflict（Kendall \(\tau\)）。
- 结果：量化 rank vs percent 的 flip rate 与争议风险。

### 3.3 Model C：驱动分析
- Judges/Fans 双模型：
  \[
  \text{logit}(j_{i,t})=\mathbf x_i^\top\beta^{(J)}+u_{\text{pro}}^{(J)}+u_{\text{season}}^{(J)}
  \]
  \[
  \text{logit}(v_{i,t})=\mathbf x_i^\top\beta^{(F)}+u_{\text{pro}}^{(F)}+u_{\text{season}}^{(F)}
  \]
- 输出：pro dancer effects（fans − judges），以及 covariate 差异。

### 3.4 Model D：DAWS 机制
- 冲突触发：当 rank 与 percent 结果不一致时启动 judge-save。
- 默认模式：非冲突周继续 percent（50/50）。
- 目的：在透明触发规则下平衡 agency 与 integrity。

## 4. 验证与敏感性
- **PPC**：后验样本回放淘汰结果。
- **合成验证**：真值轨迹落入 HDI 的覆盖率。
- **参数扫掠**：\(\sigma\)、\(\epsilon\)、\(\rho\) 的鲁棒性检查。

## 5. 代码与产物映射
- 主流水线：`src/pipeline.py`
- 结果输出：`outputs/`（metrics、audit 诊断）
- 论文图表：`paper/figures/`
- 汇总指标：`paper/summary_metrics.tex` / `outputs/summary_metrics.json`

> 本框架强调：先审计可行性与不确定性，再做机制对比与设计，保证结论可追溯、可复现、可解释。
